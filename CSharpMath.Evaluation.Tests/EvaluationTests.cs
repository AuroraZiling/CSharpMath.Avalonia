using System.Linq;
using Xunit;
using AngouriMath;

namespace CSharpMath {
  using Atom;
  public class EvluationTests {
    MathList ParseLaTeX(string latex) =>
      LaTeXParser.MathListFromLaTeX(latex).Match(list => list, e => throw new Xunit.Sdk.XunitException(e));
    Entity ParseMath(string latex) =>
      Evaluation.MathListToEntity(ParseLaTeX(latex)).Match(entity => entity, e => throw new Xunit.Sdk.XunitException(e));
    void Test(string input, string converted, string result) {
      var math = ParseMath(input);
      Assert.Equal(converted, LaTeXParser.MathListToLaTeX(Evaluation.MathListFromEntity(math)).ToString());
      // Ensure that the converted entity is valid by simplifying it
      Assert.Equal(result, LaTeXParser.MathListToLaTeX(Evaluation.MathListFromEntity(math.Simplify())).ToString());
    }
    [Theory]
    [InlineData("1")]
    [InlineData("1234")]
    [InlineData("1234.", "1234")]
    [InlineData(".5678", "0.5678")]
    [InlineData("1234.5678")]
    public void Numbers(string number, string? output = null) =>
      Test(number, output ?? number, output ?? number);
    [Theory]
    [InlineData("a", "a", "a")]
    [InlineData("ab", @"a\times b", @"a\times b")]
    [InlineData("abc", @"a\times b\times c", @"a\times b\times c")]
    [InlineData("3a", @"3\times a", @"3\times a")]
    [InlineData("3ab", @"3\times a\times b", @"3\times a\times b")]
    [InlineData("3a3", @"3\times a\times 3", @"9\times a")]
    [InlineData("3aa", @"3\times a\times a", @"3\times a^2")]
    [InlineData(@"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",
      @"a\times b\times c\times d\times e\times f\times g\times h\times i\times j\times k\times l\times m\times " +
      @"n\times o\times p\times q\times r\times s\times t\times u\times v\times w\times x\times y\times z\times " +
      @"A\times B\times C\times D\times E\times F\times G\times H\times I\times J\times K\times L\times M\times " +
      @"N\times O\times P\times Q\times R\times S\times T\times U\times V\times W\times X\times Y\times Z",
      // i is considered as a number instead of a variable like other alphabets, so it is sorted to the front
      @"i\times a\times A\times b\times B\times c\times C\times d\times D\times e\times E\times f\times F\times " +
      @"g\times G\times h\times H\times I\times j\times J\times k\times K\times l\times L\times m\times M\times " +
      @"n\times N\times o\times O\times p\times P\times q\times Q\times r\times R\times s\times S\times t\times " +
      @"T\times u\times U\times v\times V\times w\times W\times x\times X\times y\times Y\times z\times Z")]
    [InlineData(@"\alpha\beta\gamma\delta\epsilon\varepsilon\zeta\eta\theta\iota\kappa\varkappa" +
      @"\lambda\mu\nu\xi\omicron\pi\varpi\rho\varrho\sigma\varsigma\tau\upsilon\phi\varphi\chi" +
      @"\psi\omega\Gamma\Delta\Theta\Lambda\Xi\Pi\Sigma\Upsilon\Phi\Psi\Omega",
      @"\alpha \times \beta \times \gamma \times \delta \times \epsilon \times \varepsilon \times \zeta " +
      @"\times \eta \times \theta \times \iota \times \kappa \times \varkappa \times \lambda \times \mu " +
      @"\times \nu \times \xi \times \omicron \times \pi \times \varpi \times \rho \times \varrho " +
      @"\times \sigma \times \varsigma \times \tau \times \upsilon \times \phi \times \varphi \times \chi " +
      @"\times \psi \times \omega \times \Gamma \times \Delta \times \Theta \times \Lambda \times \Xi " +
      @"\times \Pi \times \Sigma \times \Upsilon \times \Phi \times \Psi \times \Omega ",
      @"\alpha \times \beta \times \chi \times \delta \times \Delta \times \epsilon \times \eta " +
      @"\times \gamma \times \Gamma \times \iota \times \kappa \times \lambda \times \Lambda \times \mu " +
      @"\times \nu \times \omega \times \Omega \times \omicron \times \phi \times \Phi \times \pi " +
      @"\times \Pi \times \psi \times \Psi \times \rho \times \sigma \times \Sigma \times \tau " +
      @"\times \theta \times \Theta \times \upsilon \times \Upsilon \times \varepsilon \times \varkappa " +
      @"\times \varphi \times \varpi \times \varrho \times \varsigma \times \xi \times \Xi \times \zeta ")]
    public void Variables(string input, string converted, string result) => Test(input, converted, result);
    [Theory]
    [InlineData("a + b", @"a+b", "a+b")]
    [InlineData("a - b", @"a-b", "a-b")]
    [InlineData("a * b", @"a\times b", @"a\times b")]
    [InlineData(@"a\times b", @"a\times b", @"a\times b")]
    [InlineData(@"a\cdot b", @"a\times b", @"a\times b")]
    [InlineData(@"a / b", @"\frac{a}{b}", @"\frac{a}{b}")]
    [InlineData(@"a\div b", @"\frac{a}{b}", @"\frac{a}{b}")]
    [InlineData(@"\frac ab", @"\frac{a}{b}", @"\frac{a}{b}")]
    [InlineData("a + b + c", @"a+b+c", "a+b+c")]
    [InlineData("a + b - c", @"a+b-c", "a+b-c")]
    [InlineData("a + b * c", @"a+b\times c", @"a+b\times c")]
    [InlineData("a + b / c", @"a+\frac{b}{c}", @"a+\frac{b}{c}")]
    [InlineData("a - b + c", @"a-b+c", "a+c-b")]
    [InlineData("a - b - c", @"a-b-c", @"a-\left( b+c\right) ")]
    [InlineData("a - b * c", @"a-b\times c", @"a-b\times c")]
    [InlineData("a - b / c", @"a-\frac{b}{c}", @"a-\frac{b}{c}")]
    [InlineData("a * b + c", @"a\times b+c", @"a\times b+c")]
    [InlineData("a * b - c", @"a\times b-c", @"a\times b-c")]
    [InlineData("a * b * c", @"a\times b\times c", @"a\times b\times c")]
    [InlineData("a * b / c", @"\frac{a\times b}{c}", @"\frac{a\times b}{c}")]
    [InlineData("a / b + c", @"\frac{a}{b}+c", @"\frac{a}{b}+c")]
    [InlineData("a / b - c", @"\frac{a}{b}-c", @"\frac{a}{b}-c")]
    [InlineData("a / b * c", @"\frac{a}{b}\times c", @"\frac{a\times c}{b}")]
    [InlineData("a / b / c", @"\frac{\frac{a}{b}}{c}", @"\frac{\frac{a}{b}}{c}")]
    [InlineData(@"2+\frac ab", @"2+\frac{a}{b}", @"2+\frac{a}{b}")]
    [InlineData(@"\frac ab+2", @"\frac{a}{b}+2", @"2+\frac{a}{b}")]
    [InlineData(@"2-\frac ab", @"2-\frac{a}{b}", @"2-\frac{a}{b}")]
    [InlineData(@"\frac ab-2", @"\frac{a}{b}-2", @"\frac{a}{b}-2")]
    [InlineData(@"2*\frac ab", @"2\times \frac{a}{b}", @"\frac{2\times a}{b}")]
    [InlineData(@"\frac ab*2", @"\frac{a}{b}\times 2", @"\frac{2\times a}{b}")]
    [InlineData(@"2/\frac ab", @"\frac{2}{\frac{a}{b}}", @"\frac{2\times b}{a}")]
    [InlineData(@"\frac ab/2", @"\frac{\frac{a}{b}}{2}", @"\frac{\frac{a}{2}}{b}")]
    public void BinaryOperators(string latex, string converted, string result) => Test(latex, converted, result);
    [Theory]
    [InlineData("+a", "a", "a")]
    [InlineData("-a", "-a", "-a")]
    [InlineData("++a", "a", "a")]
    [InlineData("+-a", "-a", "-a")]
    [InlineData("-+a", "-a", "-a")]
    [InlineData("--a", "--a", "a")]
    [InlineData("+++a", "a", "a")]
    [InlineData("---a", "---a", "-a")]
    [InlineData("a++a", "a+a", @"2\times a")]
    [InlineData("a+-a", "a+-a", "0")]
    [InlineData("a-+a", "a-a", "0")]
    [InlineData("a--a", "a--a", @"2\times a")]
    [InlineData("a+++a", "a+a", @"2\times a")]
    [InlineData("a---a", "a---a", "0")]
    [InlineData("a*+a", @"a\times a", "a^2")]
    [InlineData("a*-a", @"a\times -a", "-a^2")]
    [InlineData("+a*+a", @"a\times a", "a^2")]
    [InlineData("-a*-a", @"-a\times -a", "a^2")]
    [InlineData("a/+a", @"\frac{a}{a}", "1")]
    [InlineData("a/-a", @"\frac{a}{-a}", "-1")]
    [InlineData("+a/+a", @"\frac{a}{a}", "1")]
    [InlineData("-a/-a", @"\frac{-a}{-a}", "1")]
    [InlineData("-2+-2+-2", @"-2+-2+-2", "-6")]
    [InlineData("-2--2--2", @"-2--2--2", "2")]
    [InlineData("-2*-2*-2", @"-2\times -2\times -2", "-8")]
    [InlineData("-2/-2/-2", @"\frac{\frac{-2}{-2}}{-2}", "-0.5")]
    public void UnaryOperators(string latex, string converted, string result) => Test(latex, converted, result);
    [Theory]
    [InlineData(@"9\%", @"\frac{9}{100}", "0.09")]
    [InlineData(@"a\%", @"\frac{a}{100}", @"0.01\times a")]
    [InlineData(@"\pi\%", @"\frac{\pi }{100}", @"0.01\times \pi ")]
    [InlineData(@"a\%\%", @"\frac{\frac{a}{100}}{100}", @"0.0001\times a")]
    [InlineData(@"9\%+3", @"\frac{9}{100}+3", "3.09")]
    [InlineData(@"-9\%+3", @"-\frac{9}{100}+3", "2.91")]
    [InlineData(@"2^2\%", @"\frac{2^2}{100}", "0.04")]
    [InlineData(@"2\%^2", @"\left( \frac{2}{100}\right) ^2", "0.0004")]
    [InlineData(@"2\%2", @"\frac{2}{100}\times 2", "0.04")]
    [InlineData(@"1+2\%^2", @"1+\left( \frac{2}{100}\right) ^2", "1.0004")]
    [InlineData(@"9\degree", @"\frac{9\times \pi }{180}", @"0.05\times \pi ")]
    [InlineData(@"a\degree", @"\frac{a\times \pi }{180}", @"0.005555555555555556\times a\times \pi ")]
    [InlineData(@"\pi\degree", @"\frac{\pi \times \pi }{180}", @"0.005555555555555556\times \pi ^2")]
    [InlineData(@"a\%\degree", @"\frac{\frac{a}{100}\times \pi }{180}", @"5.555555555555556E-05\times a\times \pi ")]
    [InlineData(@"a\degree\degree", @"\frac{\frac{a\times \pi }{180}\times \pi }{180}", @"3.08641975308642E-05\times a\times \pi ^2")]
    [InlineData(@"9\degree+3", @"\frac{9\times \pi }{180}+3", @"3+0.05\times \pi ")]
    [InlineData(@"-9\degree+3", @"-\frac{9\times \pi }{180}+3", @"3+-0.05\times \pi ")]
    [InlineData(@"2^2\degree", @"\frac{2^2\times \pi }{180}", @"0.022222222222222223\times \pi ")]
    [InlineData(@"2\degree^2", @"\left( \frac{2\times \pi }{180}\right) ^2", @"0.0001234567901234568\times \pi ^2")]
    [InlineData(@"2\degree2", @"\frac{2\times \pi }{180}\times 2", @"0.022222222222222223\times \pi ")]
    [InlineData(@"1+2\degree^2", @"1+\left( \frac{2\times \pi }{180}\right) ^2", @"1+0.0001234567901234568\times \pi ^2")]
    public void PostfixOperators(string latex, string converted, string result) => Test(latex, converted, result);
    [Theory]
    [InlineData("2^2", "2^2", "4")]
    [InlineData(".2^2", "0.2^2", "0.04000000000000001")]
    [InlineData("2.^2", "2^2", "4")]
    [InlineData("2.1^2", "2.1^2", "4.41")]
    [InlineData("a^a", "a^a", "a^a")]
    [InlineData("a^{a+b}", "a^{a+b}", "a^{a+b}")]
    [InlineData("a^{-2}", "a^{-2}", "a^{-2}")]
    [InlineData("2^{3^4}", "2^{3^4}", "2.4178516392292583E+24")]
    [InlineData("4^{3^2}", "4^{3^2}", "262144")]
    [InlineData("4^3+2", "4^3+2", "66")]
    [InlineData("2+3^4", "2+3^4", "83")]
    [InlineData("4^3*2", @"4^3\times 2", "128")]
    [InlineData("2*3^4", @"2\times 3^4", "162")]
    [InlineData("1/x", @"\frac{1}{x}", @"x^{-1}")]
    [InlineData("2/x", @"\frac{2}{x}", @"\frac{2}{x}")]
    [InlineData("0^x", @"0^x", @"0")]
    [InlineData("1^x", @"1^x", @"1")]
    [InlineData("x^0", @"x^0", @"1")]
    [InlineData(@"{\frac 12}^4", @"\left( \frac{1}{2}\right) ^4", "0.0625")]
    [InlineData(@"\sqrt2", @"\sqrt{2}", "1.4142135623730951")]
    [InlineData(@"\sqrt2^2", @"\left( \sqrt{2}\right) ^2", "2.0000000000000004")]
    [InlineData(@"\sqrt[3]2", @"2^{\frac{1}{3}}", "1.2599210498948732")]
    [InlineData(@"\sqrt[3]2^3", @"\left( 2^{\frac{1}{3}}\right) ^3", "2")]
    [InlineData(@"\sqrt[3]2^{1+1+1}", @"\left( 2^{\frac{1}{3}}\right) ^{1+1+1}", "2")]
    [InlineData(@"\sqrt[1+1+1]2^{1+1+1}", @"\left( 2^{\frac{1}{1+1+1}}\right) ^{1+1+1}", "2")]
    public void Exponents(string latex, string converted, string result) => Test(latex, converted, result);
    [Theory]
    [InlineData(@"\sin x", @"\sin \left( x\right) ", @"\sin \left( x\right) ")]
    [InlineData(@"\cos x", @"\cos \left( x\right) ", @"\cos \left( x\right) ")]
    [InlineData(@"\tan x", @"\tan \left( x\right) ", @"\tan \left( x\right) ")]
    [InlineData(@"\cot x", @"\cot \left( x\right) ", @"\cot \left( x\right) ")]
    [InlineData(@"\sec x", @"\frac{1}{\cos \left( x\right) }", @"\cos \left( x\right) ^{-1}")]
    [InlineData(@"\csc x", @"\frac{1}{\sin \left( x\right) }", @"\sin \left( x\right) ^{-1}")]
    [InlineData(@"\arcsin x", @"\arcsin \left( x\right) ", @"\arcsin \left( x\right) ")]
    [InlineData(@"\arccos x", @"\arccos \left( x\right) ", @"\arccos \left( x\right) ")]
    [InlineData(@"\arctan x", @"\arctan \left( x\right) ", @"\arctan \left( x\right) ")]
    [InlineData(@"\arccot x", @"\arccot \left( x\right) ", @"\arccot \left( x\right) ")]
    [InlineData(@"\arcsec x", @"\arccos \left( \frac{1}{x}\right) ", @"\arccos \left( x^{-1}\right) ")]
    [InlineData(@"\arccsc x", @"\arcsin \left( \frac{1}{x}\right) ", @"\arcsin \left( x^{-1}\right) ")]
    [InlineData(@"\ln x", @"\ln \left( x\right) ", @"\ln \left( x\right) ")]
    [InlineData(@"\log x", @"\log \left( x\right) ", @"\log \left( x\right) ")]
    [InlineData(@"\log_3 x", @"\log _3\left( x\right) ", @"\log _3\left( x\right) ")]
    [InlineData(@"\log_{10} x", @"\log \left( x\right) ", @"\log \left( x\right) ")]
    [InlineData(@"\log_e x", @"\ln \left( x\right) ", @"\ln \left( x\right) ")]
    [InlineData(@"\ln x^2", @"\ln \left( x^2\right) ", @"\ln \left( x^2\right) ")]
    [InlineData(@"\log x^2", @"\log \left( x^2\right) ", @"\log \left( x^2\right) ")]
    [InlineData(@"\log_{10} x^2", @"\log \left( x^2\right) ", @"\log \left( x^2\right) ")]
    [InlineData(@"\log_3 x^2", @"\log _3\left( x^2\right) ", @"\log _3\left( x^2\right) ")]
    [InlineData(@"\log_e x^2", @"\ln \left( x^2\right) ", @"\ln \left( x^2\right) ")]
    [InlineData(@"\ln x^{-1}", @"\ln \left( x^{-1}\right) ", @"\ln \left( x^{-1}\right) ")]
    [InlineData(@"\log x^{-1}", @"\log \left( x^{-1}\right) ", @"\log \left( x^{-1}\right) ")]
    [InlineData(@"\log_{10} x^{-1}", @"\log \left( x^{-1}\right) ", @"\log \left( x^{-1}\right) ")]
    [InlineData(@"\log_3 x^{-1}", @"\log _3\left( x^{-1}\right) ", @"\log _3\left( x^{-1}\right) ")]
    [InlineData(@"\log_e x^{-1}", @"\ln \left( x^{-1}\right) ", @"\ln \left( x^{-1}\right) ")]
    [InlineData(@"2\sin x", @"2\times \sin \left( x\right) ", @"2\times \sin \left( x\right) ")]
    [InlineData(@"\sin 2x", @"\sin \left( 2\times x\right) ", @"\sin \left( 2\times x\right) ")]
    [InlineData(@"\sin xy", @"\sin \left( x\times y\right) ", @"\sin \left( x\times y\right) ")]
    [InlineData(@"\cos +x", @"\cos \left( x\right) ", @"\cos \left( x\right) ")]
    [InlineData(@"\cos -x", @"\cos \left( -x\right) ", @"\cos \left( -x\right) ")]
    [InlineData(@"\tan x\%", @"\tan \left( \frac{x}{100}\right) ", @"\tan \left( 0.01\times x\right) ")]
    [InlineData(@"\tan x\%^2", @"\tan \left( \left( \frac{x}{100}\right) ^2\right) ", @"\tan \left( 0.0001\times x^2\right) ")]
    [InlineData(@"\cot x*y", @"\cot \left( x\right) \times y", @"\cot \left( x\right) \times y")]
    [InlineData(@"\cot x/y", @"\frac{\cot \left( x\right) }{y}", @"\frac{\cot \left( x\right) }{y}")]
    [InlineData(@"\cos \arccos x", @"\cos \left( \arccos \left( x\right) \right) ", @"x")]
    [InlineData(@"\sin^2 x", @"\sin \left( x\right) ^2", @"\sin \left( x\right) ^2")]
    [InlineData(@"\sin^2 xy+\cos^2 yx", @"\sin \left( x\times y\right) ^2+\cos \left( y\times x\right) ^2", @"1")]
    [InlineData(@"\log^2 x", @"\log \left( x\right) ^2", @"\log \left( x\right) ^2")]
    [InlineData(@"\ln^2 x", @"\ln \left( x\right) ^2", @"\ln \left( x\right) ^2")]
    [InlineData(@"\log_{10}^2 x", @"\log \left( x\right) ^2", @"\log \left( x\right) ^2")]
    [InlineData(@"\log_3^2 x", @"\log _3\left( x\right) ^2", @"\log _3\left( x\right) ^2")]
    public void Functions(string latex, string converted, string result) => Test(latex, converted, result);
    [Theory]
    [InlineData(@"\sin^{-1} x", @"\arcsin \left( x\right) ", @"\arcsin \left( x\right) ")]
    [InlineData(@"\cos^{-1} x", @"\arccos \left( x\right) ", @"\arccos \left( x\right) ")]
    [InlineData(@"\tan^{-1} x", @"\arctan \left( x\right) ", @"\arctan \left( x\right) ")]
    [InlineData(@"\cot^{-1} x", @"\arccot \left( x\right) ", @"\arccot \left( x\right) ")]
    [InlineData(@"\sec^{-1} x", @"\arccos \left( \frac{1}{x}\right) ", @"\arccos \left( x^{-1}\right) ")]
    [InlineData(@"\csc^{-1} x", @"\arcsin \left( \frac{1}{x}\right) ", @"\arcsin \left( x^{-1}\right) ")]
    [InlineData(@"\arcsin^{-1} x", @"\sin \left( x\right) ", @"\sin \left( x\right) ")]
    [InlineData(@"\arccos^{-1} x", @"\cos \left( x\right) ", @"\cos \left( x\right) ")]
    [InlineData(@"\arctan^{-1} x", @"\tan \left( x\right) ", @"\tan \left( x\right) ")]
    [InlineData(@"\arccot^{-1} x", @"\cot \left( x\right) ", @"\cot \left( x\right) ")]
    [InlineData(@"\arcsec^{-1} x", @"\frac{1}{\cos \left( x\right) }", @"\cos \left( x\right) ^{-1}")]
    [InlineData(@"\arccsc^{-1} x", @"\frac{1}{\sin \left( x\right) }", @"\sin \left( x\right) ^{-1}")]
    [InlineData(@"\ln^{-1} x", @"e^x", @"e^x")]
    [InlineData(@"\log^{-1} x", @"10^x", @"10^x")]
    [InlineData(@"\log_3^{-1} x", @"3^x", @"3^x")]
    [InlineData(@"\log^{-1}_{10} x", @"10^x", @"10^x")]
    [InlineData(@"\log_e^{-1} x", @"e^x", @"e^x")]
    [InlineData(@"\ln^{-1} x^2", @"e^{x^2}", @"e^{x^2}")]
    [InlineData(@"\log^{-1} x^2", @"10^{x^2}", @"10^{x^2}")]
    [InlineData(@"\log_{10}^{-1} x^2", @"10^{x^2}", @"10^{x^2}")]
    [InlineData(@"\log_3^{-1} x^2", @"3^{x^2}", @"3^{x^2}")]
    [InlineData(@"\log_e^{-1} x^2", @"e^{x^2}", @"e^{x^2}")]
    [InlineData(@"\ln^{-1} x^{-1}", @"e^{x^{-1}}", @"e^{x^{-1}}")]
    [InlineData(@"\log^{-1} x^{-1}", @"10^{x^{-1}}", @"10^{x^{-1}}")]
    [InlineData(@"\log_{10}^{-1} x^{-1}", @"10^{x^{-1}}", @"10^{x^{-1}}")]
    [InlineData(@"\log_3^{-1} x^{-1}", @"3^{x^{-1}}", @"3^{x^{-1}}")]
    [InlineData(@"\log_e^{-1} x^{-1}", @"e^{x^{-1}}", @"e^{x^{-1}}")]
    [InlineData(@"2\sin^{-1} x", @"2\times \arcsin \left( x\right) ", @"2\times \arcsin \left( x\right) ")]
    [InlineData(@"\sin^{-1} 2x", @"\arcsin \left( 2\times x\right) ", @"\arcsin \left( 2\times x\right) ")]
    [InlineData(@"\sin^{-1} xy", @"\arcsin \left( x\times y\right) ", @"\arcsin \left( x\times y\right) ")]
    [InlineData(@"\cos^{-1} +x", @"\arccos \left( x\right) ", @"\arccos \left( x\right) ")]
    [InlineData(@"\cos^{-1} -x", @"\arccos \left( -x\right) ", @"\arccos \left( -x\right) ")]
    [InlineData(@"\tan^{-1} x\%", @"\arctan \left( \frac{x}{100}\right) ", @"\arctan \left( 0.01\times x\right) ")]
    [InlineData(@"\tan^{-1} x\%^2", @"\arctan \left( \left( \frac{x}{100}\right) ^2\right) ", @"\arctan \left( 0.0001\times x^2\right) ")]
    [InlineData(@"\cot^{-1} x*y", @"\arccot \left( x\right) \times y", @"\arccot \left( x\right) \times y")]
    [InlineData(@"\cot^{-1} x/y", @"\frac{\arccot \left( x\right) }{y}", @"\frac{\arccot \left( x\right) }{y}")]
    [InlineData(@"\cos^{-1} \arccos^{-1} x", @"\arccos \left( \cos \left( x\right) \right) ", @"x")]
    [InlineData(@"\sin^1 x", @"\sin \left( x\right) ^1", @"\sin \left( x\right) ")]
    [InlineData(@"\sin^{+1} x", @"\sin \left( x\right) ^1", @"\sin \left( x\right) ")]
    [InlineData(@"\sin^{+-1} x", @"\sin \left( x\right) ^{-1}", @"\sin \left( x\right) ^{-1}")]
    [InlineData(@"\sin^{-+1} x", @"\sin \left( x\right) ^{-1}", @"\sin \left( x\right) ^{-1}")]
    [InlineData(@"\sin^{--1} x", @"\sin \left( x\right) ^{--1}", @"\sin \left( x\right) ")]
    [InlineData(@"\sin^{-1^2} x", @"\sin \left( x\right) ^{-1^2}", @"\sin \left( x\right) ^{-1}")]
    [InlineData(@"\sin^{-1+3} xy+\cos^{-1+3} yx", @"\sin \left( x\times y\right) ^{-1+3}+\cos \left( y\times x\right) ^{-1+3}", @"1")]
    [InlineData(@"\log^{-1_2} x", @"\log \left( x\right) ^{-1}", @"\log \left( x\right) ^{-1}")]
    [InlineData(@"\ln^{3-1} x", @"\ln \left( x\right) ^{3-1}", @"\ln \left( x\right) ^2")]
    public void FunctionInverses(string latex, string converted, string result) => Test(latex, converted, result);
    [Theory]
    [InlineData(@"1+(2+3)", @"1+2+3", @"6")]
    [InlineData(@"1+((2+3))", @"1+2+3", @"6")]
    [InlineData(@"2*(3+4)", @"2\times \left( 3+4\right) ", @"14")]
    [InlineData(@"(3+4)*2", @"\left( 3+4\right) \times 2", @"14")]
    [InlineData(@"(5+6)^2", @"\left( 5+6\right) ^2", @"121")]
    [InlineData(@"(5+6)", @"5+6", @"11")]
    [InlineData(@"((5+6))", @"5+6", @"11")]
    [InlineData(@"(5+6)2", @"\left( 5+6\right) \times 2", @"22")]
    [InlineData(@"2(5+6)", @"2\times \left( 5+6\right) ", @"22")]
    [InlineData(@"2(5+6)2", @"2\times \left( 5+6\right) \times 2", @"44")]
    [InlineData(@"(5+6)x", @"\left( 5+6\right) \times x", @"11\times x")]
    [InlineData(@"x(5+6)", @"x\times \left( 5+6\right) ", @"11\times x")]
    [InlineData(@"x(5+6)x", @"x\times \left( 5+6\right) \times x", @"11\times x^2")]
    [InlineData(@"(5+6).2", @"\left( 5+6\right) \times 0.2", @"2.2")]
    [InlineData(@".2(5+6)", @"0.2\times \left( 5+6\right) ", @"2.2")]
    [InlineData(@".2(5+6).2", @"0.2\times \left( 5+6\right) \times 0.2", @"0.44000000000000006")]
    [InlineData(@"(5+6)2.", @"\left( 5+6\right) \times 2", @"22")]
    [InlineData(@"2.(5+6)", @"2\times \left( 5+6\right) ", @"22")]
    [InlineData(@"2.(5+6)2.", @"2\times \left( 5+6\right) \times 2", @"44")]
    [InlineData(@"(5+6)(2)", @"\left( 5+6\right) \times 2", @"22")]
    [InlineData(@"(5+6)(1+1)", @"\left( 5+6\right) \times \left( 1+1\right) ", @"22")]
    [InlineData(@"(5+6)(-(-2))", @"\left( 5+6\right) \times --2", @"22")]
    [InlineData(@"(5+6)(--2)", @"\left( 5+6\right) \times --2", @"22")]
    [InlineData(@"+(1)", @"1", @"1")]
    [InlineData(@"+(1)\%", @"\frac{1}{100}", @"0.01")]
    [InlineData(@"+(-1)", @"-1", @"-1")]
    [InlineData(@"-(+1)", @"-1", @"-1")]
    [InlineData(@"-(-1)", @"--1", @"1")]
    [InlineData(@"--(--1)", @"----1", @"1")]
    [InlineData(@"(2+3)^{(4+5)}", @"\left( 2+3\right) ^{4+5}", @"1953125")]
    [InlineData(@"(2+3)^{((4)+5)}", @"\left( 2+3\right) ^{4+5}", @"1953125")]
    [InlineData(@"2\sin(x)", @"2\times \sin \left( x\right) ", @"2\times \sin \left( x\right) ")]
    [InlineData(@"(2)\sin(x)", @"2\times \sin \left( x\right) ", @"2\times \sin \left( x\right) ")]
    [InlineData(@"\sin(x+1)", @"\sin \left( x+1\right) ", @"\sin \left( 1+x\right) ")]
    [InlineData(@"\sin((x+1))", @"\sin \left( x+1\right) ", @"\sin \left( 1+x\right) ")]
    [InlineData(@"\sin(2(x+1))", @"\sin \left( 2\times \left( x+1\right) \right) ", @"\sin \left( 2\times \left( 1+x\right) \right) ")]
    [InlineData(@"\sin((x+1)+2)", @"\sin \left( x+1+2\right) ", @"\sin \left( 3+x\right) ")]
    [InlineData(@"\sin(x)2", @"\sin \left( x\right) \times 2", @"2\times \sin \left( x\right) ")]
    [InlineData(@"\sin(x)(x+1)", @"\sin \left( x\right) \times \left( x+1\right) ", @"\sin \left( x\right) \times \left( 1+x\right) ")]
    [InlineData(@"\sin(x)(x+1)(x)", @"\sin \left( x\right) \times \left( x+1\right) \times x", @"\sin \left( x\right) \times \left( 1+x\right) \times x")]
    [InlineData(@"\sin(x^2)", @"\sin \left( x^2\right) ", @"\sin \left( x^2\right) ")]
    [InlineData(@"\sin\ (x^2)", @"\sin \left( x^2\right) ", @"\sin \left( x^2\right) ")]
    [InlineData(@"\sin\; (x^2)", @"\sin \left( x^2\right) ", @"\sin \left( x^2\right) ")]
    [InlineData(@"\sin\ \; (x^2)", @"\sin \left( x^2\right) ", @"\sin \left( x^2\right) ")]
    [InlineData(@"\sin^3(x)", @"\sin \left( x\right) ^3", @"\sin \left( x\right) ^3")]
    [InlineData(@"\sin^3\ (x)", @"\sin \left( x\right) ^3", @"\sin \left( x\right) ^3")]
    [InlineData(@"\sin^3\; (x)", @"\sin \left( x\right) ^3", @"\sin \left( x\right) ^3")]
    [InlineData(@"\sin^3\ \; (x)", @"\sin \left( x\right) ^3", @"\sin \left( x\right) ^3")]
    [InlineData(@"\sin^{-1}(x)", @"\arcsin \left( x\right) ", @"\arcsin \left( x\right) ")]
    [InlineData(@"\sin^{-1}\ (x)", @"\arcsin \left( x\right) ", @"\arcsin \left( x\right) ")]
    [InlineData(@"\sin^{-1}\; (x)", @"\arcsin \left( x\right) ", @"\arcsin \left( x\right) ")]
    [InlineData(@"\sin^{-1}\ \; (x)", @"\arcsin \left( x\right) ", @"\arcsin \left( x\right) ")]
    [InlineData(@"\sin(x)^2", @"\sin \left( x\right) ^2", @"\sin \left( x\right) ^2")]
    [InlineData(@"\sin\ (x)^2", @"\sin \left( x\right) ^2", @"\sin \left( x\right) ^2")]
    [InlineData(@"\sin\; (x)^2", @"\sin \left( x\right) ^2", @"\sin \left( x\right) ^2")]
    [InlineData(@"\sin\ \; (x)^2", @"\sin \left( x\right) ^2", @"\sin \left( x\right) ^2")]
    [InlineData(@"\sin(x)^{-1}", @"\sin \left( x\right) ^{-1}", @"\sin \left( x\right) ^{-1}")]
    [InlineData(@"\sin\ (x)^{-1}", @"\sin \left( x\right) ^{-1}", @"\sin \left( x\right) ^{-1}")]
    [InlineData(@"\sin\; (x)^{-1}", @"\sin \left( x\right) ^{-1}", @"\sin \left( x\right) ^{-1}")]
    [InlineData(@"\sin\ \; (x)^{-1}", @"\sin \left( x\right) ^{-1}", @"\sin \left( x\right) ^{-1}")]
    [InlineData(@"\sin^3(x)^{-1}", @"\sin \left( x\right) ^{3\times -1}", @"\sin \left( x\right) ^{-3}")]
    [InlineData(@"\sin^3\ (x)^{-1}", @"\sin \left( x\right) ^{3\times -1}", @"\sin \left( x\right) ^{-3}")]
    [InlineData(@"\sin^3\; (x)^{-1}", @"\sin \left( x\right) ^{3\times -1}", @"\sin \left( x\right) ^{-3}")]
    [InlineData(@"\sin^3\ \; (x)^{-1}", @"\sin \left( x\right) ^{3\times -1}", @"\sin \left( x\right) ^{-3}")]
    [InlineData(@"\sin^{-1}(x)^{-1}", @"\arcsin \left( x\right) ^{-1}", @"\arcsin \left( x\right) ^{-1}")]
    [InlineData(@"\sin^{-1}\ (x)^{-1}", @"\arcsin \left( x\right) ^{-1}", @"\arcsin \left( x\right) ^{-1}")]
    [InlineData(@"\sin^{-1}\; (x)^{-1}", @"\arcsin \left( x\right) ^{-1}", @"\arcsin \left( x\right) ^{-1}")]
    [InlineData(@"\sin^{-1}\ \; (x)^{-1}", @"\arcsin \left( x\right) ^{-1}", @"\arcsin \left( x\right) ^{-1}")]
    [InlineData(@"\sin^a(x)", @"\sin \left( x\right) ^a", @"\sin \left( x\right) ^a")]
    [InlineData(@"\sin^a(x)^2", @"\sin \left( x\right) ^{a\times 2}", @"\sin \left( x\right) ^{2\times a}")]
    [InlineData(@"\sin^a\ (x)^2", @"\sin \left( x\right) ^{a\times 2}", @"\sin \left( x\right) ^{2\times a}")]
    [InlineData(@"\sin^a\; (x)^2", @"\sin \left( x\right) ^{a\times 2}", @"\sin \left( x\right) ^{2\times a}")]
    [InlineData(@"\sin^a\ \; (x)^2", @"\sin \left( x\right) ^{a\times 2}", @"\sin \left( x\right) ^{2\times a}")]
    [InlineData(@"\sin(x)^2(x)", @"\sin \left( x\right) ^2\times x", @"\sin \left( x\right) ^2\times x")]
    [InlineData(@"\sin\ (x)^2(x)", @"\sin \left( x\right) ^2\times x", @"\sin \left( x\right) ^2\times x")]
    [InlineData(@"\sin\; (x)^2(x)", @"\sin \left( x\right) ^2\times x", @"\sin \left( x\right) ^2\times x")]
    [InlineData(@"\sin\ \; (x)^2(x)", @"\sin \left( x\right) ^2\times x", @"\sin \left( x\right) ^2\times x")]
    [InlineData(@"\sin^a(x)^2(x)", @"\sin \left( x\right) ^{a\times 2}\times x", @"\sin \left( x\right) ^{2\times a}\times x")]
    [InlineData(@"\sin^a\ (x)^2(x)", @"\sin \left( x\right) ^{a\times 2}\times x", @"\sin \left( x\right) ^{2\times a}\times x")]
    [InlineData(@"\sin^a\; (x)^2(x)", @"\sin \left( x\right) ^{a\times 2}\times x", @"\sin \left( x\right) ^{2\times a}\times x")]
    [InlineData(@"\sin^a\ \; (x)^2(x)", @"\sin \left( x\right) ^{a\times 2}\times x", @"\sin \left( x\right) ^{2\times a}\times x")]
    public void Parentheses(string latex, string converted, string result) {
      Test(latex, converted, result);
      Test(latex.Replace("(", @"\left(").Replace(")", @"\right)"), converted, result);
    }
    [Theory]
    [InlineData(@"", "There is nothing to evaluate")]
    [InlineData(@"\ ", "There is nothing to evaluate")]
    [InlineData(@"\;", "There is nothing to evaluate")]
    [InlineData(@"\quad", "There is nothing to evaluate")]
    [InlineData(@"+", "Missing right operand for +")]
    [InlineData(@"-", "Missing right operand for \u2212")]
    [InlineData(@"\times", "Unsupported Unary Operator ×")]
    [InlineData(@"\div", "Unsupported Unary Operator ÷")]
    [InlineData(@"\%", "Missing left operand for %")]
    [InlineData(@"\degree", "Missing left operand for °")]
    [InlineData(@"\dagger", "Unsupported Unary Operator †")]
    [InlineData(@"\times x", "Unsupported Unary Operator ×")]
    [InlineData(@"\div x", "Unsupported Unary Operator ÷")]
    [InlineData(@"\% x", "Missing left operand for %")]
    [InlineData(@"\degree x", "Missing left operand for °")]
    [InlineData(@"x+", "Missing right operand for +")]
    [InlineData(@"x-", "Missing right operand for \u2212")]
    [InlineData(@"x\times", "Missing right operand for ×")]
    [InlineData(@"x\div", "Missing right operand for ÷")]
    [InlineData(@"x\dagger", "Unsupported Binary Operator †")]
    [InlineData(@".", "Invalid number: .")]
    [InlineData(@"..", "Invalid number: ..")]
    [InlineData(@"1..", "Invalid number: 1..")]
    [InlineData(@"..1", "Invalid number: ..1")]
    [InlineData(@"\square", "Placeholders should be filled")]
    [InlineData(@"x^\square", "Placeholders should be filled")]
    [InlineData(@"\square^x", "Placeholders should be filled")]
    [InlineData(@"(", "Missing )")]
    [InlineData(@"(x", "Missing )")]
    [InlineData(@"((x)", "Missing )")]
    [InlineData(@"(+", "Missing right operand for +")]
    [InlineData(@")", "Missing math before )")]
    [InlineData(@"x)", "Missing (")]
    [InlineData(@"(x))", "Missing (")]
    [InlineData(@"+)", "Missing math before )")]
    [InlineData(@"\left(\right)", "Missing math between ()")]
    [InlineData(@"\frac{}{x}", "Missing numerator")]
    [InlineData(@"\frac{x}{}", "Missing denominator")]
    [InlineData(@"\sqrt{}", "Missing radicand")]
    [InlineData(@"\sin", "Missing argument for sin")]
    [InlineData(@"\cos-", "Missing right operand for \u2212")]
    [InlineData(@"\tan\times", "Unsupported Unary Operator ×")]
    [InlineData(@"\cot^(-1)", "Missing )")]
    [InlineData(@"\sec\csc", "Missing argument for csc")]
    [InlineData(@"\operatorname{dab}", "Unsupported Large Operator dab")]
    [InlineData(@"=", "Unsupported Relation =")]
    public void Error(string badLaTeX, string error) =>
      Evaluation.MathListToEntity(ParseLaTeX(badLaTeX))
      .Match(entity => throw new Xunit.Sdk.XunitException(entity.Latexise()), e => Assert.Equal(error, e));
  }
}
